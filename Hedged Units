import statistics
import csv
import pandas as pd
import math

print("Please input size of position being hedged")
No_of_contracts = int(input())
print("Please input size of one futures contract")
Value_per_contract = int(input())

HSI_Fut = pd.read_csv('Hang Seng Futures Historical Data.csv')
HSI_Fut = HSI_Fut.filter(['Date','Price'])
HSI_Fut["Price"] = [float(str(i).replace(",", "")) for i in HSI_Fut["Price"]]
HSI_Fut['Price_change'] = HSI_Fut['Price'].pct_change()

CSI_Spot = pd.read_csv('Shanghai Shenzhen CSI 300 Historical Data.csv')
CSI_Spot = CSI_Spot.filter(['Date','Price'])
CSI_Spot["Price"] = [float(str(i).replace(",", "")) for i in CSI_Spot["Price"]]
CSI_Spot['Price_change'] = CSI_Spot['Price'].pct_change()

CSI_std = CSI_Spot['Price_change'].std()
HSI_std = HSI_Fut['Price_change'].std()
Correlation = HSI_Fut['Price_change'].corr(CSI_Spot['Price_change'])

Hedge_Ratio = Correlation * (CSI_std/HSI_std) #Ratio of spot to futures
Risk_Reduction = sqrt(1-Hedge_Ratio**2)
Hedge_Units = Hedge_Ratio * (No_of_contracts/Value_per_contract)

print(f"Hedge Ratio is at {Hedge_Ratio}.\n
      The minimum variance hedge will reduce the risk by a factor of {Risk_Reduction}.\n
      Optimal number of futures contact to purchase is at {Hedge_Units}")
