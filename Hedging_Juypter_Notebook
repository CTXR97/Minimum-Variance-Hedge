import statistics
import csv
import pandas as pd
import math
from sklearn.linear_model import LinearRegression
import numpy as np

print("Please input size of position being hedged")
No_of_contracts = int(input())
print("Please input size of one futures contract")
Value_per_contract = int(input())

#Read the different contracts

SPOT = pd.read_excel('CO1.xlsx', skiprows=6)
FUT1 = pd.read_excel('TTF.xlsx', skiprows=7)

#Calculate the percentage change

SPOT['Price_change'] = SPOT['PX_LAST'].pct_change()
FUT1['Price_change'] = FUT1['PX_LAST'].pct_change()

#Calculate Stdev

SPOT_std = SPOT['Price_change'].std()
FUT1_std = FUT1['Price_change'].std()

#Calculate Variance

SPOT_var = SPOT['Price_change'].var()
FUT1_var = FUT1['Price_change'].var()

#Calculate Correlation

Correlation_FUT1 = SPOT['Price_change'].corr(FUT1['Price_change'])

#Calculate Hedge Ratio

Hedge_Ratio_FUT1 = Correlation_FUT1 * (SPOT_std/FUT1_std)

#Calculate Risk_Reduction

Risk_Reduction_FUT1 = math.sqrt(1-Hedge_Ratio_FUT1**2)

#Calculate Optimal contracts

Hedge_Units_FUT1 = Hedge_Ratio_FUT1 * (No_of_contracts/Value_per_contract)

#Calculate Basis Risk

Basis_Risk_FUT1 = SPOT_var + (Hedge_Ratio_FUT1*FUT1_var) - (2*Correlation_FUT1*SPOT_std*(Hedge_Ratio_FUT1*FUT1_std))

#Summary table 

Contracts = ['AUG22']
Hedge_Ratio = [Hedge_Ratio_FUT1]
Risk_Reduction = [Risk_Reduction_FUT1]
Hedge_units = [Hedge_Units_FUT1]
Basis_risk = [Basis_Risk_FUT1]

Summary = pd.DataFrame()
Summary['Contracts'] = Contracts
Summary['Basis_risk'] = Basis_risk
Summary['Hedge_Ratio'] = Hedge_Ratio
Summary['Risk_Reduction'] = Risk_Reduction 
Summary['Hedge_units'] = Hedge_units


print(Summary)

#Find regression of the different contracts against the SPOT

SPOT['PX_LAST'].dropna()
FUT1['PX_LAST'].dropna()

x = np.array(SPOT['PX_LAST']).reshape(-1,1)
y = np.array(FUT1['PX_LAST']).reshape(-1,1)
model_1 = LinearRegression()
model_1.fit(x, y)
   
